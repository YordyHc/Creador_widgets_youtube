<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link rel="stylesheet" href="../assets/style/widget_1.css" />
    <title>widget 1</title>
  </head>

  <body class="yorwids">
    <div class="channel-header">
      <img id="img_portada" class="channel-banner" alt="Banner" />

      <div class="profile">
        <br /><br /><br /><br /><br /><br />
        <a
          href="https://www.youtube.com/channel/UC5ZiUaIJ2b5dYBYGf5iEUrA"
          target="_blank"
          rel="noopener noreferrer"
        >
          <img id="img_perfil" class="logo" alt="Logo del canal" />
        </a>
        <div class="pf-data">
          <br />
          <h2>
            <a
              id="canal_url"
              href="#"
              target="_blank"
              rel="noopener noreferrer"
            ></a>
          </h2>
          <p id="stats" class="stats"></p>
        </div>
        <a
          id="yt_button_url"
          class="subscribe-btn"
          href="#"
          target="_blank"
          rel="noopener noreferrer"
        >
          <i class="fa-brands fa-youtube"></i>
        </a>
      </div>
    </div>

    <!-- GALERÍA DE VIDEOS -->

    <div class="gallery-container container-fluid">
      <button class="gallery-nav-btn gallery-prev">
        <i class="fa-solid fa-angle-left"></i>
      </button>

      <div class="gallery" id="gallery"></div>

      <button class="gallery-nav-btn gallery-next">
        <i class="fa-solid fa-angle-right"></i>
      </button>
      <div class="pagination"></div>
    </div>

    <!-- MODAL -->

    <!--<div id="myModal" class="modal-overlay">
      <button class="modal-close"><i class="fa-solid fa-xmark"></i></button>
      <div class="modal-content">
        <div class="video-iframe-container">
          <iframe
            id="videoFrame"
            width="100%"
            height="400"
            src=""
            frameborder="0"
            allow="autoplay; encrypted-media"
            allowfullscreen=""
            title="YouTube video player"
          ></iframe>
        </div>

        <div class="modal-info">
          <h3 id="modal_titulo" class="md_title"></h3>
          <div class="md-stats">
            <p id="md_views" class="md-info"><i class="fa-solid fa-eye"></i></p>
            <p class="md-info likes">
              <i class="fa-solid fa-thumbs-up"></i> 676
            </p>
          </div>
          <p id="md_views"></p>
        </div>
      </div>
    </div>

    <div class="modal-overlay">
      <button class="modal-close"><i class="fa-solid fa-xmark"></i></button>
      <div class="modal-content">
        
        <div class="modal-info">
          <h3 class="md_title">
            Berlín y la dama del armiño | Anuncio de fecha de estreno | Netflix
          </h3>
          <div class="md-stats">
            <p class="md-info">30.5K vistas <i class="fa-solid fa-eye"></i></p>
            <p class="md-info likes">
              <i class="fa-solid fa-thumbs-up"></i> 676
            </p>
          </div>
          <div class="profile-md">
            <a
              href="https://www.youtube.com/channel/UC5ZiUaIJ2b5dYBYGf5iEUrA"
              target="_blank"
              rel="noopener noreferrer"
              ><img
                class="logo"
                alt="Logo del canal"
                src="https://yt3.ggpht.com/Jkyhl4-Nnkk6gHI1PitrcxiXVUyo2-oCc6nlfk2MMOtLEUt9Wt-bdCtNV1xON-x-u9-5OpWm=s240-c-k-c0x00ffffff-no-rj"
            /></a>
            <div class="pf-data">
              <strong
                ><h6>
                  <a
                    href="https://www.youtube.com/channel/UC5ZiUaIJ2b5dYBYGf5iEUrA"
                    target="_blank"
                    rel="noopener noreferrer"
                    >Netflix Latinoamérica</a
                  >
                </h6></strong
              >
              <p class="md-info-fecha">publicado en 10/12/2025</p>
              <p class="md-description">
                «Berlín y la dama del armiño» se estrenará en Netflix el 15 de
                mayo de 2026. En esta nueva entrega de la serie basada en el ...
              </p>
            </div>
            <a
              class="subscribe-btn"
              href="https://www.youtube.com/channel/UC5ZiUaIJ2b5dYBYGf5iEUrA"
              target="_blank"
              rel="noopener noreferrer"
              ><i class="fa-brands fa-youtube"></i>Youtube 13.8M</a
            >
          </div>
        </div>
      </div>
    </div>-->
    <!-- =============================== -->
    <!-- RECEPCIÓN DE DATOS DESDE REACT -->
    <!-- =============================== -->
    <script>
      window.addEventListener("message", (event) => {
        if (!event.data) return;

        const { datos, videos } = event.data;

        if (!datos || !videos) return;

        // Datos del canal (objeto plano)
        document.getElementById("img_portada").src = datos.bannerImage;
        document.getElementById("img_perfil").src = datos.logoUrl;

        document.getElementById("canal_url").href =
          "https://www.youtube.com/channel/" + datos.idcanal;
        document.getElementById("canal_url").textContent = datos.title;

        document.getElementById(
          "stats"
        ).textContent = `${datos.subscriberCount} Suscriptores • ${datos.videoCount} Videos • ${datos.viewCount} Vistas`;

        document.getElementById("yt_button_url").href =
          "https://www.youtube.com/channel/" + datos.idcanal;

        // Construir galería con los videos reales
        buildGallery(videos);
      });
    </script>

    <script>
      let currentSlide = 0;

      function buildGallery(videos) {
        const gallery = document.getElementById("gallery");
        gallery.innerHTML = "";

        const chunked = chunkArray(videos, 3);

        chunked.forEach((chunk) => {
          const slide = document.createElement("div");
          slide.classList.add("slide");

          chunk.forEach((video) => {
            const videoCard = createVideoCard(video);
            slide.appendChild(videoCard);
          });

          gallery.appendChild(slide);
        });

        buildPagination(chunked.length);
        updateCarousel();
      }

      /* Crear la tarjeta del video con tu estructura JSX equivalente */
      function createVideoCard(video) {
        const container = document.createElement("div");
        container.classList.add("video");
        container.dataset.videoId = video.id;

        container.onclick = () => playvideoFromData(container);

        const miniatura = document.createElement("div");
        miniatura.classList.add("miniatura");

        const img = document.createElement("img");
        img.src = video.thumbnail;
        img.classList.add("thumbnail");
        img.alt = `Miniatura de ${video.title}`;

        const play = document.createElement("button");
        play.classList.add("play-button");

        const duration = document.createElement("span");
        duration.classList.add("video-duration");
        duration.textContent = video.duration;

        miniatura.appendChild(img);
        miniatura.appendChild(play);
        miniatura.appendChild(duration);

        const title = document.createElement("p");
        title.classList.add("video-title");
        title.innerHTML = `<strong>${video.title}</strong>`;

        const fecha = document.createElement("p");
        fecha.classList.add("video-info");
        fecha.textContent = video.publishedAt;

        const description = document.createElement("p");
        description.classList.add("video-description");
        description.textContent = video.description;

        const info = document.createElement("p");
        info.classList.add("video-info");
        info.textContent =
          `${Number(video.viewCount)} vistas • ` +
          `${Number(video.likeCount)} likes • ` +
          `${Number(video.commentCount)} comentarios`;

        container.appendChild(miniatura);
        container.appendChild(title);
        container.appendChild(fecha);
        container.appendChild(description);
        container.appendChild(info);

        return container;
      }

      /* -------------------------
     CONTROLES DEL CARRUSEL
-------------------------- */
      function nextSlide() {
        const totalSlides = document.getElementById("gallery").children.length;
        if (currentSlide < totalSlides - 1) currentSlide++;
        updateCarousel();
      }

      function prevSlide() {
        if (currentSlide > 0) currentSlide--;
        updateCarousel();
      }

      function updateCarousel() {
        const gallery = document.getElementById("gallery");
        gallery.style.transform = `translateX(-${currentSlide * 100}%)`;
        updatePagination();
      }

      /* -------------------------
        PAGINACIÓN
-------------------------- */
      function buildPagination(totalSlides) {
        const pagination = document.querySelector(".pagination");
        pagination.innerHTML = "";

        for (let i = 0; i < totalSlides; i++) {
          const dot = document.createElement("span");
          dot.classList.add("pagination-dot");
          dot.dataset.index = i;

          dot.onclick = () => {
            currentSlide = i;
            updateCarousel();
          };

          pagination.appendChild(dot);
        }
      }

      function updatePagination() {
        const dots = document.querySelectorAll(".pagination-dot");
        dots.forEach((dot) => dot.classList.remove("active"));
        if (dots[currentSlide]) dots[currentSlide].classList.add("active");
      }

      /* -------------------------
        UTILIDADES
-------------------------- */
      function chunkArray(arr, size) {
        const res = [];
        for (let i = 0; i < arr.length; i += size) {
          res.push(arr.slice(i, i + size));
        }
        return res;
      }

      /* Botones carrusel */
      document.querySelector(".gallery-prev").onclick = prevSlide;
      document.querySelector(".gallery-next").onclick = nextSlide;
    </script>

    <!-- =============================== -->
    <!-- MODAL VIDEO ORIGINAL -->
    <!-- =============================== -->
    <script>
      function playvideoFromData(el) {
        playvideo(
          el.dataset.videoId,
          el.dataset.videoTitle,
          el.dataset.videoViews
        );
      }

      var modal = document.getElementById("myModal");
      var closeBtn = document.getElementsByClassName("close")[0];
      var videoFrame = document.getElementById("videoFrame");

      function playvideo(id_video, titulo, vista) {
        modal.style.display = "flex";
        videoFrame.src =
          "https://www.youtube.com/embed/" + id_video + "?autoplay=1&rel=0";

        document.getElementById("modal_titulo").innerText = titulo;
        document.getElementById("md_views").innerText = vista + " vistas";
      }

      closeBtn.onclick = function () {
        modal.style.display = "none";
        videoFrame.src = "";
      };

      window.onclick = function (event) {
        if (event.target == modal) {
          modal.style.display = "none";
          videoFrame.src = "";
        }
      };
    </script>
  </body>
</html>
