<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link rel="stylesheet" href="../assets/style/widget_1.css" />
    <title>widget 1</title>
  </head>

  <body>
    <div class="container-fluid">
      <div class="container-fluid">
        <!-- Imagen de portada -->
        <div class="header-container">
          <img id="img_portada" class="rounded-top" alt="Banner" />
        </div>
        <br /><br />

        <!-- Perfil -->
        <div class="profile">
          <br /><br /><br /><br /><br />
          <img id="img_perfil" alt="Perfil" />

          <h2>
            <a id="canal_url" href="#" target="_blank"></a>
          </h2>

          <br /><br />

          <p class="stats" id="stats"></p>

          <a id="yt_button_url" href="#" target="_blank">
            <button class="subscribe-btn btn">
              <i class="fa-brands fa-youtube"></i> Youtube
            </button>
          </a>
          <br /><br /><br />
        </div>

        <!-- GALERÍA DE VIDEOS -->
        <center>
          <div class="gallery-container">
            <button class="gallery-nav-btn btn gallery-prev">❮</button>

            <div class="gallery" id="gallery"></div>

            <button class="gallery-nav-btn btn gallery-next">❯</button>
          </div>
        </center>

        <br /><br /><br />

        <div class="controls">
          <div class="pagination"></div>
        </div>
      </div>

      <!-- MODAL -->
      <br /><br />
      <div id="myModal" class="modal">
        <div class="modal-content">
          <span class="close">&times;</span>

          <div class="iframe-container">
            <iframe
              id="videoFrame"
              src=""
              title="YouTube video player"
              frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              referrerpolicy="strict-origin-when-cross-origin"
              allowfullscreen
            >
            </iframe>
          </div>

          <div class="modal-extra-content">
            <p id="modal_titulo" style="font-size: 25px"></p>
            <p id="md_views"></p>
          </div>
        </div>
      </div>
    </div>

    <!-- =============================== -->
    <!-- RECEPCIÓN DE DATOS DESDE REACT -->
    <!-- =============================== -->
    <script>
      window.addEventListener("message", (event) => {
        if (!event.data) return;

        const { datos, videos } = event.data;

        if (!datos || !videos) return;

        // Datos del canal (objeto plano)
        document.getElementById("img_portada").src = datos.bannerImage;
        document.getElementById("img_perfil").src = datos.logoUrl;

        document.getElementById("canal_url").href =
          "https://www.youtube.com/channel/" + datos.idcanal;
        document.getElementById("canal_url").textContent = datos.title;

        document.getElementById(
          "stats"
        ).textContent = `${datos.subscriberCount} Suscriptores • ${datos.videoCount} Videos • ${datos.viewCount} Vistas`;

        document.getElementById("yt_button_url").href =
          "https://www.youtube.com/channel/" + datos.idcanal;

        // Construir galería con los videos reales
        buildGallery(videos);
      });
    </script>

    <!-- =============================== -->
    <!-- CREAR GALERÍA DINÁMICAMENTE -->
    <!-- =============================== -->
    <script>
      function buildGallery(videos) {
        const gallery = document.getElementById("gallery");
        gallery.innerHTML = "";

        const chunked = chunkArray(videos, 3);

        chunked.forEach((chunk) => {
          const slide = document.createElement("div");
          slide.classList.add("carousel-slide");

          chunk.forEach((video) => {
            const div = document.createElement("div");
            div.classList.add("video", "container");

            div.dataset.videoId = video.id;
            div.dataset.videoTitle = video.title;
            div.dataset.videoViews = video.viewCount;

            div.onclick = () => playvideoFromData(div);

            div.innerHTML = `
                <div class="miniatura">
                    <img src="${video.thumbnail}" class="thumbnail" />
                    <button class="play-button"></button>
                    <span class="video-duration">${video.duration}</span>
                </div>
                <div class="texto">
                    <p class="video-title"><strong>${video.title}</strong></p>
                    <p class="video-info">${video.publishedAt}</p><br><br>
                    <p class="video-info">${video.viewCount} vistas • ${video.likeCount} likes • ${video.commentCount} comentarios</p>
                </div>
            `;

            slide.appendChild(div);
          });

          gallery.appendChild(slide);
        });

        initCarousel();
      }
    </script>

    <script>
      // Utilidad para dividir videos en grupos de 3
      function chunkArray(arr, size) {
        const temp = [];
        for (let i = 0; i < arr.length; i += size) {
          temp.push(arr.slice(i, i + size));
        }
        return temp;
      }
    </script>

    <!-- =============================== -->
    <!-- CARRUSEL ORIGINAL (NO TOCADO) -->
    <!-- =============================== -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const slides = document.querySelectorAll(".carousel-slide");
        const totalSlides = slides.length;
        const itemsPerPage = 1; // Un slide por página
        let currentIndex = 0;
        const paginationContainer = document.querySelector(".pagination");

        // Generar los botones de paginación
        const totalPages = Math.ceil(totalSlides / itemsPerPage);
        for (let i = 0; i < totalPages; i++) {
          const pageButton = document.createElement("button");
          pageButton.textContent = i + 1;
          pageButton.classList.add("pagination-btn");
          pageButton.addEventListener("click", () => goToPage(i));
          paginationContainer.appendChild(pageButton);
        }

        // Navegar a una página específica
        function goToPage(pageIndex) {
          currentIndex = pageIndex;
          updateCarousel();
          updatePagination();
        }

        // Función para actualizar la vista del carrusel
        function updateCarousel() {
          const gallery = document.querySelector(".gallery");
          const offset = -currentIndex * 100; // Desplazamiento por cada slide
          gallery.style.transform = `translateX(${offset}%)`;
        }

        // Actualizar los estilos de los botones de paginación
        function updatePagination() {
          const pageButtons = document.querySelectorAll(".pagination-btn");
          pageButtons.forEach((button, index) => {
            if (index === currentIndex) {
              button.classList.add("active"); // Resaltar el botón activo
            } else {
              button.classList.remove("active");
            }
          });
        }

        // Configurar los botones de siguiente y anterior
        document
          .querySelector(".gallery-next")
          .addEventListener("click", () => {
            if (currentIndex < totalSlides - 1) {
              currentIndex++; // Avanza al siguiente slide
              updateCarousel();
              updatePagination();
            }
          });

        document
          .querySelector(".gallery-prev")
          .addEventListener("click", () => {
            if (currentIndex > 0) {
              currentIndex--; // Retrocede al slide anterior
              updateCarousel();
              updatePagination();
            }
          });

        // Inicializa la paginación
        updatePagination();
      });
    </script>

    <!-- =============================== -->
    <!-- MODAL VIDEO ORIGINAL -->
    <!-- =============================== -->
    <script>
      function playvideoFromData(el) {
        playvideo(
          el.dataset.videoId,
          el.dataset.videoTitle,
          el.dataset.videoViews
        );
      }

      var modal = document.getElementById("myModal");
      var closeBtn = document.getElementsByClassName("close")[0];
      var videoFrame = document.getElementById("videoFrame");

      function playvideo(id_video, titulo, vista) {
        modal.style.display = "flex";
        videoFrame.src =
          "https://www.youtube.com/embed/" + id_video + "?autoplay=1&rel=0";

        document.getElementById("modal_titulo").innerText = titulo;
        document.getElementById("md_views").innerText = vista + " vistas";
      }

      closeBtn.onclick = function () {
        modal.style.display = "none";
        videoFrame.src = "";
      };

      window.onclick = function (event) {
        if (event.target == modal) {
          modal.style.display = "none";
          videoFrame.src = "";
        }
      };
    </script>
  </body>
</html>
